<div class="container mt-4">
  <div class="card shadow-sm border-0">
    <div class="card-header bg-white py-3">
      <div class="row align-items-center">
        <div class="col">
          <h1 class="h4 mb-0">Library Catalog</h1>
        </div>
        <div class="col-6">
          <search>
            <label for="bookSearch">Search books by title</label>
            <div class="input-group">
              <span class="input-group-text bg-light border-end-0" aria-hidden="true">
                <i class="bi bi-search">üîç</i>
              </span>
              <input
                id="bookSearch"
                type="text"
                class="form-control border-start-0 ps-0"
                placeholder="Search title"
                [value]="store.filter.query()"
                (input)="onUpdateQuery($any($event.target).value)"
                aria-describedby="searchHelp"
              />
            </div>
            <div id="searchHelp" class="visually-hidden">
              Results update automatically as you type.
            </div>
          </search>
        </div>
      </div>
    </div>

    <div class="visually-hidden" aria-live="polite">
      {{ store.visibleBooks().length }} books found.
    </div>

    <div class="table-responsive">
      <button type="button" class="skip-table-link" (click)="skipToEnd($event, tableEnd)">
        Skip book list
      </button>
      <table class="table table-hover align-middle mb-0" aria-labelledby="catalog-heading">
        <thead class="table-light">
          <tr>
            <th scope="col" style="width: 10%">ID</th>
            <th
              scope="col"
              [attr.aria-sort]="store.filter.order() === 'asc' ? 'ascending' : 'descending'"
            >
              <button
                #changeOrderButton
                type="button"
                class="btn btn-link p-0 text-dark fw-bold text-decoration-none d-flex align-items-center"
                (click)="onChangeOrder()"
                aria-label="Sort by title"
              >
                Title
                <span class="ms-1" aria-hidden="true">
                  {{ store.filter.order() === 'asc' ? '‚Üë' : '‚Üì' }}
                </span>
              </button>
            </th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (book of store.visibleBooks(); track book.id) {
          <tr>
            <td>
              <span class="text-muted small">#{{ book.id }}</span>
            </td>
            <td class="fw-bold">{{ book.title }}</td>
            <td class="text-end">
              <a
                class="btn btn-sm btn-outline-primary"
                [routerLink]="[book.id]"
                [attr.aria-label]="'Read book: ' + book.title"
              >
                Read
              </a>
              <button
                class="btn btn-sm btn-outline-primary ms-1"
                (click)="selectBook(book.id)"
                [attr.aria-label]="'Edit book: ' + book.title"
              >
                Edit
              </button>
              <button
                class="btn btn-sm btn-outline-danger ms-1"
                (click)="deleteBook(book)"
                [attr.aria-label]="'Delete book: ' + book.title"
              >
                Delete
              </button>
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="3" class="text-center py-5 text-muted">
              <p role="status">No books found matching "{{ store.filter.query() }}"</p>
            </td>
          </tr>
          }
        </tbody>
      </table>
      <div #tableEnd id="table-end" tabindex="-1"></div>
    </div>
  </div>
</div>

<app-delete-book-modal></app-delete-book-modal>
